app:
  build:
    dockerfile_path: Dockerfile
  encrypted_env_file: aws.env.encrypted
  links:
    - dynamo
    - init-dynamo
  environment:
    - dataTable=speedsnitch_local_data
    - AWS_ACCESS_KEY_ID=0
    - AWS_SECRET_ACCESS_KEY=0
    - AWS_DEFAULT_REGION=us-east-1
    - AWS_DYNAMODB_ENDPOINT=http://dynamo:8000
  working_dir: /go/src/github.com/silinternational/speed-snitch-admin-api

dynamo:
  image: dwmkerr/dynamodb
  command: "-sharedDb"
  hostname: dynamo
  environment:
    - reschedule=on-node-failure

init-dynamo:
  image: garland/aws-cli-docker
  command: "aws dynamodb create-table --table-name speedsnitch_local_data --attribute-definitions AttributeName=ID,AttributeType=S --key-schema AttributeName=ID,KeyType=HASH --provisioned-throughput ReadCapacityUnits=50,WriteCapacityUnits=50 --endpoint-url http://dynamo:8000"
  links:
    - dynamo
  environment:
    - AWS_ACCESS_KEY_ID=0
    - AWS_SECRET_ACCESS_KEY=0
    - AWS_DEFAULT_REGION=us-east-1

tracker:
    image: silintl/app-deployment-tracker-ga:latest
    environment:
        TRACKING_ID: UA-56269387-10